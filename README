v0.2 18/01/2011

Keene Electronics sell a little USB FM Transmitter, the audio part of which works out of the box with linux, 
but the applet supplied to do the radio stuff only works with Windows. See:

http://www.keene.co.uk/electronics/multi.php?mycode=USBFMT#
(Supposedly the Windows program works under linux using wine/winetricks but I could never get it to work, plus my audio server runs headless.)
good review here:
http://www.reghardware.com/2010/09/27/review_gadget_keene_usb_fm_transmitter/

Using Snoop USB for Windows XP, usbsnoop2libusb.pl, and some code somebody wrote for the OWL
electricity monitor, I reverse engineered most of the key functions, and this program attempts 
to control the FM transmitter side of the device.

Compiling:

You need libusb and libusb-dev (in Debian apt-get install libusb libusb-dev),

gcc -o keene keene.c -lusb

Using:

When you plug the device in, it presents as a composite device, one is the audio device,
the other a HID device. On one of my PC's the alsa control is set to 0 after the device is 
plugged in, set this to about 80, if FM is distorted try reducing this.

The program accepts one argument which is the FM transmitter frequency without decimal place,
e.g. 98.80 is 9880, execute the program like:

./keene 9880

When excuted the program will attempt to set the frequency as set, it will set the tx gain to
full, kick the device into stereo, and set it to use European FM, as such the frequencies available are
87.50 - 108.00 (8750 - 10800). The increments available are 0.05, if you call 8881 for example it will 
round to 88.80.

Currently this needs root, I suspect a udev rule is required.

The USB ID of my device is 046d:0a0e, if yours is different then you'll need to change the source.

NOTE: This is very rough and ready. Use at your own risk. As you can see my C skillz are virtually non-existent,
please be kind.

TODO: 
Figure out how to run it as non-root
Allow configurable for not EU FM

ACKNOWLEDGEMENT:
Thanks to Anonymous Graham in the comments here, for giving me the basis for this code. 
http://automation.binarysage.net/?p=765&cpage=3#comments
Thanks to te author of usbsnoop2libusb.pl, that provided much help in figuring out the format of the urb messages.
http://iki.fi/lindi/usb/usbsnoop2libusb.pl

LICENSE:
No specific license, please feel free to do what you want with it. If you improve it please let me know
as I like to learn.
